(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{29:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(20),i=n.n(s),o=n(8),r=(n(29),n(22)),l=n(2),u=n(3),p=n.p+"static/media/logo.bbe2a6ea.svg",d=n(0);var h=function(e){var t=Object(u.h)(),n=c.a.useState({action:"/sign-up"===t.pathname?"\u0412\u043e\u0439\u0442\u0438":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",link:"/sign-up"===t.pathname?"/sign-in":"/sign-up"}),a=Object(l.a)(n,2),s=a[0],i=a[1],r=e.email;return c.a.useEffect((function(){i(r?{action:"\u0412\u044b\u0439\u0442\u0438",link:"/sign-in"}:{action:"/sign-up"===t.pathname?"\u0412\u043e\u0439\u0442\u0438":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",link:"/sign-up"===t.pathname?"/sign-in":"/sign-up"})}),[r,t]),Object(d.jsxs)("header",{className:"header body__header",children:[Object(d.jsx)("img",{className:"header__logo",src:p,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f \u0441\u0430\u0439\u0442\u0430 Mesto"}),Object(d.jsxs)("div",{children:[r?Object(d.jsx)("span",{className:"header__email",children:r}):null,Object(d.jsx)(o.b,{className:"header__action ".concat(r?"header__action_color_grey":""),to:s.link,onClick:r?e.logOut:function(e){var t="\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"===e.currentTarget.innerText?"\u0412\u043e\u0439\u0442\u0438":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",n="\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"===e.currentTarget.innerText?"/sign-in":"/sign-up";i({action:t,link:n})},children:s.action})]})]})},m=c.a.createContext();var j=function(e){var t=c.a.useContext(m),n=e.card.owner._id===t._id,a=e.card.likes.some((function(e){return e._id===t._id}));return Object(d.jsxs)("li",{className:"element",children:[Object(d.jsx)("div",{className:"element__delete ".concat(n?"element__delete_active":""),children:Object(d.jsx)("button",{className:"element__delete-button",onClick:function(){e.onCardDelete(e.card)}})}),Object(d.jsx)("img",{className:"element__image",src:e.card.link,alt:e.card.name,onClick:function(){e.onCardClick(e.card)}}),Object(d.jsxs)("div",{className:"element__group",children:[Object(d.jsx)("h2",{className:"element__name",children:e.card.name}),Object(d.jsxs)("div",{className:"element__like-group",children:[Object(d.jsx)("button",{className:"element__like ".concat(a?"element__like_active":""),onClick:function(){e.onCardLike(e.card)}}),Object(d.jsx)("span",{className:"element__like-counter",children:e.card.likes.length})]})]})]})};function _(e){var t=c.a.useContext(m),n=e.cards.map((function(t){return Object(d.jsx)(j,{card:t,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete},t._id)}));return Object(d.jsxs)("main",{className:"main",children:[Object(d.jsxs)("section",{className:"profile main__profile",children:[Object(d.jsxs)("div",{className:"profile__main-info",children:[Object(d.jsx)("div",{className:"profile__avatar",onClick:e.onEditAvatar,style:{backgroundImage:"url(".concat(t.avatar,")")}}),Object(d.jsxs)("div",{className:"profile__info",children:[Object(d.jsx)("h1",{className:"profile__name",children:t.name}),Object(d.jsx)("button",{className:"profile__edit",type:"button","aria-label":"Edit",onClick:e.onEditProfile}),Object(d.jsx)("p",{className:"profile__description",children:t.about})]})]}),Object(d.jsx)("button",{className:"profile__add-button",type:"button","aria-label":"Add",onClick:e.onAddPlace})]}),Object(d.jsx)("section",{className:"elements main__elements",children:Object(d.jsx)("ul",{className:"elements__list",children:n})})]})}function b(e){return Object(d.jsx)("footer",{className:"footer body__footer",children:"\xa92021 Mesto Russia"})}var f=function(e){return Object(d.jsxs)("section",{className:"popup popup_type_image ".concat(e.isTooltip&&"popup_image-tooltip"," ").concat(e.card&&"popup_opened"),onClick:e.onClose,children:[Object(d.jsx)("button",{className:"popup__close-button",type:"reset","aria-label":"Close"}),Object(d.jsxs)("figure",{className:"popup__container popup__figure ".concat(e.isTooltip&&"tooltip"),children:[Object(d.jsx)("img",{className:"popup__image ".concat(e.isTooltip&&"tooltip__img"),src:e.card&&e.card.link,alt:e.card&&e.card.name}),Object(d.jsx)("figcaption",{className:"popup__figcaption ".concat(e.isTooltip&&"tooltip__caption"),children:e.card&&e.card.name})]})]})},O=n(13),v=n(14),g=(n.p,new(function(){function e(t){Object(O.a)(this,e),this._url=t.url,this._headers=t.headers}return Object(v.a)(e,[{key:"getUserInfo",value:function(){return fetch("".concat(this._url,"/users/me"),{headers:this._headers}).then(this._resolve)}},{key:"getCards",value:function(e){return fetch("".concat(this._url,"/cards"),{headers:this._headers}).then(this._resolve)}},{key:"changeUserInfo",value:function(e){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._resolve)}},{key:"changeAvatar",value:function(e){return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then(this._resolve)}},{key:"addCard",value:function(e){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._resolve)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._resolve)}},{key:"changeLike",value:function(e,t){var n=t?"PUT":"DELETE";return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:n,headers:this._headers}).then(this._resolve)}},{key:"deleteLike",value:function(e){return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then(this._resolve)}},{key:"addLike",value:function(e){return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then(this._resolve)}},{key:"_resolve",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}}]),e}())({url:"https://mesto.nomoreparties.co/v1/cohort-23",headers:{authorization:"e2787495-d10a-4c6a-a5f2-7d4ee36816fa","Content-Type":"application/json"}})),x=new(function(){function e(t){Object(O.a)(this,e),this._url=t.url,this._headers=t.headers,this._a="dsfsdfs"}return Object(v.a)(e,[{key:"signUp",value:function(e){var t=e.email,n=e.password;return fetch("".concat(this._url,"/signup"),{method:"POST",headers:this._headers,body:JSON.stringify({password:n,email:t})}).then(this._resolve)}},{key:"signIn",value:function(e){var t=e.email,n=e.password;return fetch("".concat(this._url,"/signin"),{method:"POST",headers:this._headers,body:JSON.stringify({password:n,email:t})}).then(this._resolve)}},{key:"checkUser",value:function(e){var t=e.jwt,n=Object.assign(this._headers);return n.Authorization="Bearer ".concat(t),fetch("".concat(this._url,"/users/me"),{method:"GET",headers:n}).then(this._resolve)}},{key:"_resolve",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}}]),e}())({url:"https://auth.nomoreparties.co",headers:{"Content-Type":"application/json"}},"test");var k=function(e){return Object(d.jsxs)("section",{className:"popup popup_type_".concat(e.name," ").concat(e.isOpen&&"popup_opened"),onClick:e.onClose,children:[Object(d.jsx)("button",{className:"popup__close-button",type:"reset","aria-label":"Close"}),Object(d.jsxs)("form",{className:"popup__container",name:e.name,onSubmit:e.onSubmit,children:[Object(d.jsx)("h2",{className:"popup__title",children:e.title}),e.children,Object(d.jsx)("button",{className:"popup__confirm popup__confirm_active",type:"submit",children:e.buttonText})]})]})};var C=function(e){var t=c.a.useContext(m),n=c.a.useState("\u0416\u0430\u043a-\u0418\u0432 \u041a\u0443\u0441\u0442\u043e"),a=Object(l.a)(n,2),s=a[0],i=a[1],o=c.a.useState("\u041c\u043e\u0440\u0441\u043a\u043e\u0439 \u0438\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c"),r=Object(l.a)(o,2),u=r[0],p=r[1];c.a.useEffect((function(){t.name&&i(t.name),t.about&&p(t.about)}),[t,e.isOpen]);var h=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("input",{className:"popup__input popup__input_purpose_name",name:"element-name",type:"text",placeholder:"\u0418\u043c\u044f",required:!0,minLength:"2",maxLength:"40",value:s,onChange:function(e){i(e.currentTarget.value)}}),Object(d.jsx)("span",{className:"popup__input-error element-name-placeholder"}),Object(d.jsx)("input",{className:"popup__input popup__input_purpose_description",name:"element-link",type:"text",placeholder:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438",required:!0,minLength:"2",maxLength:"200",value:u,onChange:function(e){var t=e.currentTarget.value?e.currentTarget.value:u;p(t)}}),Object(d.jsx)("span",{className:"popup__input-error element-link-placeholder"})]});return Object(d.jsx)(k,{name:"editProfile",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:s,about:u})},buttonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",children:h})};var N=function(e){var t=c.a.useRef(null),n=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("input",{className:"popup__input popup__input_purpose_description popup__input_purpose_link",name:"avatarEditor-link",type:"url",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",ref:t}),Object(d.jsx)("span",{className:"popup__input-error avatarEditor-link-placeholder"})]});return Object(d.jsx)(k,{name:"editAvatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",buttonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){var a=t.current.value;n.preventDefault(),e.onUpdateAvatar(a)},children:n})};var y=function(e){var t=c.a.useState(""),n=Object(l.a)(t,2),a=n[0],s=n[1],i=c.a.useState(""),o=Object(l.a)(i,2),r=o[0],u=o[1],p=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("input",{className:"popup__input popup__input_purpose_name",name:"profileEditor-name",type:"text",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",required:!0,minLength:"2",maxLength:"30",value:a,onChange:function(e){s(e.currentTarget.value)}}),Object(d.jsx)("span",{className:"popup__input-error profileEditor-name-placeholder"}),Object(d.jsx)("input",{className:"popup__input popup__input_purpose_description",name:"profileEditor-description",type:"url",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",value:r,onChange:function(e){u(e.currentTarget.value)}}),Object(d.jsx)("span",{className:"popup__input-error profileEditor-description-placeholder"})]});return Object(d.jsx)(k,{name:"addPlace",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",isOpen:e.isOpen,onClose:e.onClose,buttonText:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",onSubmit:function(t){t.preventDefault(),e.onAddPlace({name:a,link:r}),s(""),u("")},children:p})};var S=function(e){var t=e.placeholders,n=c.a.useState(""),a=Object(l.a)(n,2),s=a[0],i=a[1],r=c.a.useState(""),u=Object(l.a)(r,2),p=u[0],h=u[1];return Object(d.jsxs)("div",{className:"auth-form-container body__auth-form",children:[Object(d.jsx)("h2",{className:"auth-form__title",children:e.title}),Object(d.jsxs)("form",{className:"auth-form",onSubmit:function(t){t.preventDefault(),e.onSubmit({email:s,password:p})},children:[Object(d.jsx)("input",{className:"auth-form__input auth-form__email",name:"userEmail",type:"email",placeholder:t[0],value:s,onChange:function(e){i(e.currentTarget.value)}}),Object(d.jsx)("input",{className:"auth-form__input auth-form__password",name:"userPassword",type:"password",placeholder:t[1],value:p,onChange:function(e){h(e.currentTarget.value)}}),Object(d.jsx)("button",{className:"auth-form__confirm",type:"submit",children:e.submitTitle}),e.isReg?Object(d.jsx)(o.b,{className:"auth-form__login",to:"/sign-in",children:"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? \u0412\u043e\u0439\u0442\u0438"}):null]})]})};var T=function(e){return Object(d.jsx)(S,{title:e.title,submitTitle:e.submitTitle,placeholders:e.placeholders,onSubmit:e.onSignedIn})};var E=function(e){return Object(d.jsx)(f,{card:e.succsessObj.image?{link:e.succsessObj.image,name:e.succsessObj.caption}:null,isTooltip:!0,onClose:e.onClose})};var L=function(e){return Object(d.jsx)(S,{title:e.title,submitTitle:e.submitTitle,placeholders:e.placeholders,onSubmit:e.onSignedUp,isReg:e.isReg})},P=n(23),U=n(24),A=["component"],w=function(e){var t=e.component,n=Object(U.a)(e,A);return Object(d.jsx)(u.b,{children:n.loggedIn?Object(d.jsx)(t,Object(P.a)({},n)):Object(d.jsx)(u.a,{to:"/sign-in"})})},I=n.p+"static/media/Fail.d4ce2a26.svg",D=n.p+"static/media/Success.a9eb6caf.svg";var J=function(e){var t=c.a.useState(!1),n=Object(l.a)(t,2),a=n[0],s=n[1],i=c.a.useState(!1),o=Object(l.a)(i,2),p=o[0],j=o[1],O=c.a.useState(!1),v=Object(l.a)(O,2),k=v[0],S=v[1],P=c.a.useState({}),U=Object(l.a)(P,2),A=U[0],J=U[1],R=c.a.useState(null),F=Object(l.a)(R,2),q=F[0],M=F[1],z=c.a.useState([]),B=Object(l.a)(z,2),H=B[0],G=B[1],K=c.a.useState(!1),Q=Object(l.a)(K,2),V=Q[0],W=Q[1],X=c.a.useState({image:null,caption:null}),Y=Object(l.a)(X,2),Z=Y[0],$=Y[1],ee=c.a.useState(null),te=Object(l.a)(ee,2),ne=te[0],ae=te[1],ce=Object(u.g)(),se=function(e){console.log(e)},ie=function(e){var t,n=e.data&&e.data.email?e.data.email:null,a=e.token?e.token:null;return void 0!==e.error&&(t=e.error),void 0!==e.message&&(t=e.message),void 0!==t?($({image:I,caption:t}),null):n||a},oe=function(e){27===e.keyCode&&le()};c.a.useEffect((function(){var e=localStorage.getItem("token");return e&&x.checkUser({jwt:e}).then(ie).then((function(e){e&&(W(!0),ae(e),ce.push("/"))})).catch(se),Promise.all([g.getUserInfo(),g.getCards()]).then((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];J(n),G(a)})).catch(se),document.addEventListener("keyup",oe),function(){document.removeEventListener("keyup",oe)}}),[ce,V]);var re=function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&le()},le=function(){S(!1),s(!1),j(!1),M(null),V&&ce.push("/"),$({image:null,caption:null})};return Object(d.jsxs)("div",{className:"App",children:[Object(d.jsx)(h,{email:ne,logOut:function(){localStorage.removeItem("token"),W(!1),ae(null)}}),Object(d.jsxs)(m.Provider,{value:A,children:[Object(d.jsxs)(u.d,{children:[Object(d.jsx)(u.b,{path:"/sign-up",children:Object(d.jsx)(L,{title:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",submitTitle:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f",placeholders:["Email","\u041f\u0430\u0440\u043e\u043b\u044c"],onSignedUp:function(e){x.signUp(e).then(ie).then((function(e){ae(e),W(!0),$({image:D,caption:"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!"})})).catch((function(e){se(e),$({image:I,caption:"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})}))},isReg:!0})}),Object(d.jsx)(u.b,{path:"/sign-in",children:Object(d.jsx)(T,{title:"\u0412\u0445\u043e\u0434",submitTitle:"\u0412\u043e\u0439\u0442\u0438",placeholders:["Email","\u041f\u0430\u0440\u043e\u043b\u044c"],onSignedIn:function(e){x.signIn(e).then(ie).then((function(t){localStorage.setItem("token",t),ae(e.email),W(!0),$({image:D,caption:"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u043b\u0438\u0441\u044c!"})})).catch((function(e){se(e),$({image:I,caption:"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})}))}})}),Object(d.jsx)(w,{loggedIn:V,path:"/",component:_,onEditProfile:function(){s(!0)},onAddPlace:function(){j(!0)},onEditAvatar:function(){S(!0)},onCardClick:function(e){M(e)},cards:H,onCardLike:function(e){var t=e.likes.some((function(e){return e._id===A._id}));g.changeLike(e._id,!t).then((function(e){var t=H.map((function(t){return t._id===e._id?e:t}));G(t)})).catch(se)},onCardDelete:function(e){g.deleteCard(e._id).then((function(){var t=H.filter((function(t){return e._id!==t._id?t:null}));G(t)})).catch(se)}}),Object(d.jsx)(b,{})]}),Object(d.jsx)(C,{isOpen:a,onClose:re,onUpdateUser:function(e){var t=e.name,n=e.about;t&&n&&g.changeUserInfo({name:t,about:n}).then((function(e){J(e),le()})).catch(se)}}),Object(d.jsx)(y,{isOpen:p,onClose:re,onAddPlace:function(e){var t=e.name,n=e.link;g.addCard({name:t,link:n}).then((function(e){G([e].concat(Object(r.a)(H))),le()})).catch(se)}}),Object(d.jsx)(f,{card:q,onClose:re}),Object(d.jsx)(N,{isOpen:k,onClose:re,onUpdateAvatar:function(e){e&&g.changeAvatar({avatar:e}).then((function(e){J(e),le()})).catch(se)}}),Object(d.jsx)(E,{succsessObj:Z,onClose:re})]})]})};i.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(o.a,{children:Object(d.jsx)(J,{})})}),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.3e6c4d5c.chunk.js.map